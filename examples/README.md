# solarisBank Digital Assets Platform API

## api-client

In this folder you will find `api-client` -- an example CLI application that can generate API keys and talk to the API.


### Installation

To use the `api-client` you should have a working Ruby installation.

To install all the project dependencies do:

```
cd <this folder>
bundle
```

Upon completion, you will have a working `api-client`, which you can test by running:

```
./api-client help

Commands:
  api-client approval CHALLENGE_FILENAME TX_FILENAME  # Generate a DSA_ED25519 approval response
  api-client config                                   # Display currently used configuration
  api-client generate_key                             # Generate a new API key pair
  api-client get PATH                                 # Send a GET request
  api-client help [COMMAND]                           # Describe available commands or one specific command
  api-client post PATH [BODY]                         # Send a POST request
  api-client sign FILENAME                            # Sign contents of given file using currently configured key

Options:
  -c, [--config=CONFIG]  # Use configuration from given file

```

### Configuration

The `api-client` CLI tool uses configuration stored in a local file `api-client.yml`. An example of this configuration file is provided in `api-client.yml.example`:

```yaml
api_url: https://api.sb-cryptocustody-sandbox.aws.solarisbank.io
api_key:
  id: 42d3d5260710fe195bf9c2dfd2d38917akey
  seed: f795b212026beba7fb43d0568834b5067829b9ba630cd0cef29e96897f66087d
```

## API Key generation

The `api-client` CLI tool can be used to generate API Key pairs using `generate_key` comand:

```
./api-client generate_key

Generating a new API key pair
   seed: a3e503936cd71da7e4450a3fe4c22e227a86fc6ea888fdecf09fcfb7c09cc2e8
pub_key: 7ccd8e2d736d401954d956b97db8c16a35c9dba1e26ca51bb7cb294ea05dc5c5
```

The API Key pair generated by the `api-client` is a key pair for the Ed25519 digital signature algorithm, where:

* `seed` is a 32 byte hexadecimal representation of the Ed25519 key seed (NOTE: it is NOT the 64 byte private/signing key)
* `pub_key` is a 32 byte hexadecimal representation of the Ed25519 public key

The seed and the corresponding public key can be generated using any other implementation of Ed25519 algorithm.

Before the API Key can be used to execute HTTP requests to the API, the corresponding public key must be registered at the Platform.

[TODO: Description of pub key registration process]

As a result, the ID will be assigned to this API Key by the Platform. The `id` and `seed` values must then be put into `api-client.yml` configuration file.


## Executing HTTP requests to the API

Once configured with the API Key registered at the Platform, `api-client` can be used to talk to the API:

```
./api-client get /v1/assets

> GET https://api.sb-cryptocustody-sandbox.aws.solarisbank.io/v1/assets
< 200 OK
{
  "items": [
    {
      "id": "00000000000000000000000000000001asst",
      "code": "BTC",
      "description": "Bitcoin",
      "precision": 8,
      "created_at": "2019-06-04T10:51:37Z",
      "updated_at": "2019-06-04T10:51:37Z"
    },
    {
      "id": "00000000000000000000000000000002asst",
      "code": "ETH",
      "description": "Ethereum",
      "precision": 18,
      "created_at": "2019-06-04T10:51:37Z",
      "updated_at": "2019-06-04T10:51:37Z"
    }
  ]
}
```

## Verbose HTTP requests

For development and troubleshooting purposes it's helpful to see all the HTTP headers the API
client calculates. It is possible to display them using `-v,--verbose` option of `get` and `post` commands:

```
./api-client get -v /v1/test

> GET https://api.sb-cryptocustody-sandbox.aws.solarisbank.io/v1/test
> Content-Type: application/json
> Digest: SHA-256=47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=
> X-Nonce: a3d3f4b41722882e83b6c881cf84b63b
> Signature: keyId="42d3d5260710fe195bf9c2dfd2d38917akey",algorithm="hs2019",created=1562077723,headers="(request-target) (created) digest x-nonce",signature="TZgjuYD7/IGJsJCkXmQbqC21PIM/MhKgE3D9HkAA7tc0SLIup48pjJaIwt4mCDLlnyvvwvN1mHcHzqr8SpGEDQ=="
< 200 OK (0.013s)
{
  "status": "OK"
}
```


## Transaction Approvals

The `api-client` is capable of generating an approval response for the `DSA_ED25519` approval method.

In order to produce an approval response for a Transaction, you have to have the following:

1. A transaction JSON representation stored in a file. Can be obtained by running:
```
./api-client get /v1/entities/<ENTITY_ID>/accounts/<ACCOUNT_ID>/transactions/<TRANSACTION_ID> > tx.json
```

2. An approval challenge stored in a file. Can be obtained by running:
```
./api-client get /v1/entities/<ENTITY_ID>/accounts/<ACCOUNT_ID>/transactions/<TRANSACTION_ID>/approval > challenge.json
```

3. An Approval key of the Account owner (Entity), which is registered on the platform.
This SHOULD be a key different from your API key. Store it in a `approval-key.yml` file,
which has the same format as the `api-client.yml`.

Then, to produce an approval response:
```
./api-client approval -c approval-key.yml challenge.json tx.json > approval-data.json
```

You can use the resulting `approval-data.json` in a POST request to the API:
```
./api-client post /v1/entities/<ENTITY_ID>/accounts/<ACCOUNT_ID>/transactions/<TRANSACTION_ID>/approval -f approval-data.json
```
---
